<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üí≥ Card Data Extractor</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 15px;
      background: #f5f7fa;
      color: #1a1a1a;
    }
    h1 { text-align: center; color: #2c3e50; font-size: 1.4em; }
    .desc { text-align: center; color: #555; font-size: 14px; }
    .upload-area {
      text-align: center;
      padding: 30px;
      border: 2px dashed #3498db;
      border-radius: 10px;
      background: white;
      margin: 20px 0;
    }
    input[type="file"] { margin: 10px 0; font-size: 16px; }
    button {
      padding: 10px 20px;
      background: #2980b9;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover { background: #1a6ba0; }
    #output {
      margin-top: 20px;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px;
      background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; white-space: nowrap; }
    th { background-color: #2980b9; color: white; }
    tr:nth-child(even) { background-color: #f8f9fa; }
    .loading {
      text-align: center;
      color: #7f8c8d;
      padding: 15px;
    }
  </style>
</head>
<body>

  <h1>üí≥ Card Data Extractor</h1>
  <p class="desc">Upload your PDF to extract card details into a clean table</p>

  <div class="upload-area">
    <input type="file" id="pdfInput" accept=".pdf,.txt" />
    <br>
    <button id="parseBtn" disabled>üìÑ Process File</button>
    <p><small>Tap to upload, then press "Process File"</small></p>
  </div>

  <div class="loading" id="status">Ready to upload</div>
  <div id="output"></div>

  <script>
    // Load PDF.js worker
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    const pdfInput = document.getElementById('pdfInput');
    const parseBtn = document.getElementById('parseBtn');
    const status = document.getElementById('status');
    const output = document.getElementById('output');

    pdfInput.addEventListener('change', () => {
      parseBtn.disabled = !pdfInput.files.length;
    });

    parseBtn.addEventListener('click', async () => {
      const file = pdfInput.files[0];
      if (!file) return;

      parseBtn.disabled = true;
      status.textContent = 'Reading file...';
      output.innerHTML = '';

      try {
        let text = '';

        if (file.type === 'application/pdf') {
          // Handle PDF
          const arrayBuffer = await file.arrayBuffer();
          const pdf = await pdfjsLib.getDocument({  arrayBuffer }).promise;
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
            const content = await page.getTextContent();
            text += ' ' + content.items.map(item => item.str).join(' ');
          }
        } else {
          // Handle text file
          text = await file.text();
        }

        // Clean and split by I delimiter
        text = text.replace(/\s+/g, ' ').trim();

        // Fix common OCR errors
        function clean(t) {
          return t
            .replace(/[Il1]/g, '1')
            .replace(/[O0]/g, '0')
            .replace(/\bFlorid–∞\b/g, 'Florida')
            .replace(/\bN–µw Yor–∫\b/g, 'New York')
            .replace(/\bCal1forn1a\b/g, 'California')
            .replace(/\bTexa5\b/g, 'Texas')
            .replace(/\s+/g, ' ')
            .trim();
        }

        text = clean(text);

        // Split by I and extract entries
        const lines = text.split('I');
        const results = [];

        // Known bank names
        const banks = [
          'Regions Bank', 'Navy F.C.U.', 'Gecu', 'Central Bank Of Kansas City',
          'Yellowstone Bank, The', 'Bancorp', 'Capital One Bank(Usa), National Association',
          'Fifth Third Bank, The', 'Bank Of America, N.A.', 'Usaa Savings Bank',
          'Jpmorgan Chase Bank, N.A.', 'Bbva Usa', 'Metabank, National Association',
          'Woodforest National Bank', 'Centra C.U.', 'Wells Fargo Bank, N.A.',
          'Bank Of Missouri, The'
        ];

        // Parse entries
        for (let i = 0; i < lines.length; i++) {
          if (!/^\d{15,16}$/.test(lines[i])) continue;

          const cardNumber = lines[i];
          const expMatch = lines[i+1] && lines[i+2] ? `${lines[i+1]}/${lines[i+2].slice(-2)}` : '';
          const cvv = lines[i+2] || '';
          const name = lines[i+3] || 'Unknown';
          const address = lines[i+4] || '';
          const city = lines[i+5] || '';
          let state = lines[i+6] || '';
          const zip = lines[i+7] || '';

          // Standardize state
          state = state.replace('Now Yor–∫', 'New York').replace('Texasl', 'Texas');

          // Extract bank name
          let bankName = 'Unknown';
          for (const bank of banks) {
            if (text.includes(bank)) {
              bankName = bank;
              break;
            }
          }

          results.push({
            "Card Number": cardNumber,
            "Exp. Date": expMatch,
            "CVV": cvv,
            "Name": name,
            "Address": address,
            "City": city,
            "State": state,
            "ZIP": zip,
            "Bank Name": bankName
          });

          i += 10; // Skip parsed fields
        }

        // Generate table
        let tableHTML = `<table><thead><tr>
          <th>Card Number</th><th>Exp. Date</th><th>CVV</th><th>Name</th>
          <th>Address</th><th>City</th><th>State</th><th>ZIP</th><th>Bank Name</th>
        </tr></thead><tbody>`;

        results.forEach(row => {
          tableHTML += `<tr>
            <td>${row['Card Number']}</td>
            <td>${row['Exp. Date']}</td>
            <td>${row['CVV']}</td>
            <td>${row['Name']}</td>
            <td title="${row['Address']}">${row['Address'].length > 30 ? row['Address'].substring(0,30)+'...' : row['Address']}</td>
            <td>${row['City']}</td>
            <td>${row['State']}</td>
            <td>${row['ZIP']}</td>
            <td>${row['Bank Name']}</td>
          </tr>`;
        });

        tableHTML += `</tbody></table>`;
        output.innerHTML = tableHTML;
        status.textContent = `‚úÖ Done! Found ${results.length} entries.`;

      } catch (err) {
        status.textContent = `‚ùå Error: ${err.message}`;
        console.error(err);
      }
    });
  </script>
</body>
</html>
