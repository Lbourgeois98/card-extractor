<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üí≥ Card Data Extractor</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 15px;
      background: #f5f7fa;
      color: #1a1a1a;
    }
    h1 { text-align: center; color: #2c3e50; font-size: 1.4em; }
    .desc { text-align: center; color: #555; font-size: 14px; }
    .upload-area {
      text-align: center;
      padding: 30px;
      border: 2px dashed #3498db;
      border-radius: 10px;
      background: white;
      margin: 20px 0;
    }
    input[type="file"] { margin: 10px 0; font-size: 16px; }
    button {
      padding: 10px 20px;
      background: #2980b9;
      color: white;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover { background: #1a6ba0; }
    #output {
      margin-top: 20px;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 14px;
      background: white; box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: left; white-space: nowrap; }
    th { background-color: #2980b9; color: white; }
    tr:nth-child(even) { background-color: #f8f9fa; }
    .loading {
      text-align: center;
      color: #7f8c8d;
      padding: 15px;
    }
  </style>
</head>
<body>

  <h1>üí≥ Card Data Extractor</h1>
  <p class="desc">Upload your file to extract and organize cardholder data</p>

  <div class="upload-area">
    <input type="file" id="fileInput" accept=".txt,.pdf" />
    <br>
    <button id="parseBtn" disabled>üîß Extract Data</button>
    <p><small>Supports messy files like "Extracted table.pdf"</small></p>
  </div>

  <div class="loading" id="status">Ready to upload</div>
  <div id="output"></div>

  <script>
    const fileInput = document.getElementById('fileInput');
    const parseBtn = document.getElementById('parseBtn');
    const status = document.getElementById('status');
    const output = document.getElementById('output');

    fileInput.addEventListener('change', () => {
      parseBtn.disabled = !fileInput.files.length;
    });

    parseBtn.addEventListener('click', async () => {
      const file = fileInput.files[0];
      if (!file) return;

      status.textContent = 'Reading file...';
      output.innerHTML = '';

      try {
        let text = await file.text();

        // Clean and normalize text
        text = text
          .replace(/[\u0430-\u044F]/g, '') // Remove Cyrillic
          .replace(/[Il1l|~;]/g, 'I')      // Normalize delimiters
          .replace(/\s+/g, ' ')
          .trim();

        // Known bank names
        const banks = [
          'Regions Bank', 'Navy F.C.U.', 'Gecu', 'Central Bank Of Kansas City',
          'Yellowstone Bank, The', 'Bancorp', 'Capital One Bank(Usa), National Association',
          'Fifth Third Bank, The', 'Bank Of America, N.A.', 'Usaa Savings Bank',
          'Jpmorgan Chase Bank, N.A.', 'Bbva Usa', 'Metabank', 'Woodforest National Bank',
          'Centra C.U.', 'Wells Fargo Bank, N.A.', 'Bank Of Missouri, The'
        ];

        // Split by I and extract
        const parts = text.split('I');
        const results = [];

        for (let i = 0; i < parts.length; i++) {
          if (!/^\d{15,16}$/.test(parts[i])) continue;

          const cardNumber = parts[i];
          const expMonth = parts[i+1]?.trim() || '';
          const expYear = parts[i+2]?.trim() || '';
          const cvv = parts[i+2]?.trim() || '';
          let name = parts[i+3]?.trim() || 'Unknown';
          let address = parts[i+4]?.trim() || '';
          let city = parts[i+5]?.trim() || '';
          let state = parts[i+6]?.trim() || '';
          let zip = parts[i+7]?.trim() || '';

          // Fix known issues
          if (name === 'UNITED STATES') name = parts[i+4]?.trim() || 'Unknown';
          if (address === 'UNITED STATES') address = parts[i+5]?.trim() || '';
          if (city === 'UNITED STATES') city = parts[i+6]?.trim() || '';
          if (state === 'UNITED STATES') state = parts[i+7]?.trim() || '';

          // Fix state names
          state = state
            .replace('Now Yor–∫', 'New York')
            .replace('Texasl', 'Texas')
            .replace('Now Yor<', 'New York')
            .replace('Florid–∞', 'Florida');

          // Detect bank
          let bankName = 'Unknown';
          for (const bank of banks) {
            if (text.includes(bank)) {
              bankName = bank;
              break;
            }
          }

          results.push({
            "Card Number": cardNumber,
            "Exp. Date": expMonth && expYear ? `${expMonth}/${expYear.slice(-2)}` : '',
            "CVV": cvv,
            "Name": name,
            "Address": address,
            "City": city,
            "State": state,
            "ZIP": zip,
            "Bank Name": bankName
          });

          i += 10; // Skip parsed fields
        }

        // Generate table
        let tableHTML = `<table><thead><tr>
          <th>Card Number</th><th>Exp. Date</th><th>CVV</th><th>Name</th>
          <th>Address</th><th>City</th><th>State</th><th>ZIP</th><th>Bank Name</th>
        </tr></thead><tbody>`;

        results.forEach(row => {
          tableHTML += `<tr>
            <td>${row['Card Number']}</td>
            <td>${row['Exp. Date']}</td>
            <td>${row['CVV']}</td>
            <td>${row['Name']}</td>
            <td title="${row['Address']}">${row['Address'].length > 30 ? row['Address'].substring(0,30)+'...' : row['Address']}</td>
            <td>${row['City']}</td>
            <td>${row['State']}</td>
            <td>${row['ZIP']}</td>
            <td>${row['Bank Name']}</td>
          </tr>`;
        });

        tableHTML += `</tbody></table>`;
        output.innerHTML = tableHTML;
        status.textContent = `‚úÖ Done! Found ${results.length} entries.`;

      } catch (err) {
        status.textContent = `‚ùå Error: ${err.message}`;
        console.error(err);
      }
    });
  </script>
</body>
</html>
